{% extends "base.html" %}

{% block title %}{{ current_category }} - TCS Open Problems{% endblock %}

{% block content %}
<div class="hero">
    <h1>{{ current_category }}</h1>
    <p><a href="{{ url_for('index') }}">&larr; All problems</a></p>
</div>

<div class="content-with-sidebar">
    <section class="problems-list">
        <div class="sort-bar">
            <span class="sort-label">Sort by:</span>
            <a href="?sort=votes" class="sort-option {% if current_sort == 'votes' %}active{% endif %}">Votes</a>
            <a href="?sort=impact" class="sort-option {% if current_sort == 'impact' %}active{% endif %}">Impact</a>
            <a href="?sort=solvability" class="sort-option {% if current_sort == 'solvability' %}active{% endif %}">Solvability</a>
            <a href="?sort=date" class="sort-option {% if current_sort == 'date' %}active{% endif %}">Date</a>
        </div>
        {% if problems %}
            {% for item in problems %}
            <article class="problem-card">
                <div class="vote-section">
                    {% if current_user %}
                        <form action="{{ url_for('vote', id=item.problem.id) }}" method="POST">
                            <button type="submit" class="vote-btn vote-btn-small {% if item.has_voted %}voted{% endif %}">
                                <span class="vote-arrow">&#9650;</span>
                                <span class="vote-count">{{ item.vote_count }}</span>
                            </button>
                        </form>
                    {% else %}
                        <div class="vote-btn vote-btn-small disabled">
                            <span class="vote-arrow">&#9650;</span>
                            <span class="vote-count">{{ item.vote_count }}</span>
                        </div>
                    {% endif %}
                </div>
                <div class="problem-content">
                    <a href="{{ url_for('problem', id=item.problem.id) }}">
                        <h2>{{ item.problem.title }}</h2>
                    </a>
                    {% if item.categories %}
                        <div class="categories">
                            {% for cat in item.categories %}
                                <a href="{{ url_for('category', name=cat.name) }}" class="category {% if cat.name == current_category %}active{% endif %}">{{ cat.name }}</a>
                            {% endfor %}
                        </div>
                    {% endif %}
                    <p class="preview">{{ item.problem.description[:200] }}{% if item.problem.description|length > 200 %}...{% endif %}</p>
                    <div class="meta">
                        <span>by {{ item.problem.username }}</span>
                        <span>{{ item.problem.created_at[:10] }}</span>
                    </div>
                </div>
                <div class="problem-stats">
                    <div class="ratings-display">
                        <div class="rating-item" title="Impact">
                            <span class="rating-label">Impact</span>
                            <span class="rating-value">{% if item.avg_impact %}{{ item.avg_impact }}{% else %}-{% endif %}</span>
                        </div>
                        <div class="rating-item" title="Solvability">
                            <span class="rating-label">Solvability</span>
                            <span class="rating-value">{% if item.avg_solvability %}{{ item.avg_solvability }}{% else %}-{% endif %}</span>
                        </div>
                        {% if item.rating_count > 0 %}
                            <span class="rating-count">({{ item.rating_count }} rating{% if item.rating_count != 1 %}s{% endif %})</span>
                        {% endif %}
                    </div>
                </div>
            </article>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <p>No problems in this category yet.</p>
            </div>
        {% endif %}
    </section>

    {% if categories %}
    <aside class="sidebar">
        <h3>Categories</h3>
        <ul class="category-list">
            {% for cat in categories %}
                <li {% if cat.name == current_category %}class="active"{% endif %}>
                    <a href="{{ url_for('category', name=cat.name) }}">{{ cat.name }}</a>
                </li>
            {% endfor %}
        </ul>
    </aside>
    {% endif %}
</div>
{% endblock %}
